<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>dockerとgitlabを使ったお手軽CMS環境構築　その1 | tooth-pick</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="結構前の話ですが、ブログをおうちサーバのWordpressからConohaのVPS上にdockerを使用し、hexoを構築した環境へと移行しました。その過程で色々とdockerの長所的な物を利用したブログ更新環境を構築したのでメモ。
本文を書いていたところかなりの長文になってしまったため、4記事くらいに分割しました。">
<meta property="og:type" content="article">
<meta property="og:title" content="dockerとgitlabを使ったお手軽CMS環境構築　その1">
<meta property="og:url" content="https://www.tooth-pick.xyz/2017/03/25/easy-cms-system-1/index.html">
<meta property="og:site_name" content="tooth-pick">
<meta property="og:description" content="結構前の話ですが、ブログをおうちサーバのWordpressからConohaのVPS上にdockerを使用し、hexoを構築した環境へと移行しました。その過程で色々とdockerの長所的な物を利用したブログ更新環境を構築したのでメモ。
本文を書いていたところかなりの長文になってしまったため、4記事くらいに分割しました。">
<meta property="og:image" content="https://www.tooth-pick.xyz/img/2017/docker_hexo_gitlab.png">
<meta property="og:updated_time" content="2017-03-25T06:02:22.916Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="dockerとgitlabを使ったお手軽CMS環境構築　その1">
<meta name="twitter:description" content="結構前の話ですが、ブログをおうちサーバのWordpressからConohaのVPS上にdockerを使用し、hexoを構築した環境へと移行しました。その過程で色々とdockerの長所的な物を利用したブログ更新環境を構築したのでメモ。
本文を書いていたところかなりの長文になってしまったため、4記事くらいに分割しました。">
<meta name="twitter:image" content="https://www.tooth-pick.xyz/img/2017/docker_hexo_gitlab.png">
<meta name="twitter:creator" content="@tumayouzi_s">
  
    <link rel="alternate" href="/atom.xml" title="tooth-pick" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/earlyaccess/sawarabigothic.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/earlyaccess/notosansjapanese.css" rel="stylesheet" />
  
  <link rel="stylesheet" href="/css/style.css">
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-93230723-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">tooth-pick</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">割り箸に爪楊枝を添えて</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="//www.tooth-pick.xyz/doujin/">同人</a>
        
          <a class="main-nav-link" href="//www.tooth-pick.xyz/make_app/">作った物</a>
        
          <a class="main-nav-link" href="https://twitter.com/#!/tumayouzi_s">Twitter</a>
        
          <a class="main-nav-link" href="https://www.flickr.com/photos/tumayouzi/">Flickr</a>
        
          <a class="main-nav-link" href="https://tumayouzi.tumblr.com/">Tumblr</a>
        
          <a class="main-nav-link" href="//www.amazon.co.jp/registry/wishlist/11MRS9G3P6DDA/ref=cm_sw_r_tw_ws_YN7bxb0C1QVDC">欲しいものリスト</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://www.tooth-pick.xyz"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-easy-cms-system-1" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/03/25/easy-cms-system-1/" class="article-date">
  <time datetime="2017-03-25T04:22:04.000Z" itemprop="datePublished">2017-03-25</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/サーバ/">サーバ</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      dockerとgitlabを使ったお手軽CMS環境構築　その1
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- 2017.05.24 twitter and hatebu share button Add -->
        <div class="share-button">
          <!-- twitter share button -->
          <a href="https://twitter.com/share" class="twitter-share-button" data-url="https://www.tooth-pick.xyz/2017/03/25/easy-cms-system-1/" data-text="dockerとgitlabを使ったお手軽CMS環境構築　その1 | tooth-pick" data-lang="ja">ツイート</a>
          <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
        <!-- twitter share button End -->
        <!--  hatebu share button Start -->
          <a href="http://b.hatena.ne.jp/entry/https://www.tooth-pick.xyz/2017/03/25/easy-cms-system-1/" class="hatena-bookmark-button" data-hatena-bookmark-title="dockerとgitlabを使ったお手軽CMS環境構築　その1" data-hatena-bookmark-layout="standard-balloon" data-hatena-bookmark-lang="ja" title="このエントリーをはてなブックマークに追加"><img src="https://b.st-hatena.com/images/entry-button/button-only@2x.png" alt="このエントリーをはてなブックマークに追加" width="20" height="20" style="border: none;" /></a><script type="text/javascript" src="https://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script>
        <!-- hatebu share button End -->
        </div>
        <!-- twitter and hatebu share button End -->
        <p><img src="/img/2017/docker_hexo_gitlab.png" alt=""></p>
<p>結構前の話ですが、ブログをおうちサーバのWordpressからConohaのVPS上にdockerを使用し、hexoを構築した環境へと移行しました。<br>その過程で色々とdockerの長所的な物を利用したブログ更新環境を構築したのでメモ。</p>
<p><strong><em>本文を書いていたところかなりの長文になってしまったため、4記事くらいに分割しました。</em></strong></p>
<a id="more"></a>
<h1 id="移行のきっかけ"><a href="#移行のきっかけ" class="headerlink" title="移行のきっかけ"></a>移行のきっかけ</h1><ul>
<li>Wordpressの脆弱性対応の手間</li>
<li>Wordpressの記事の書きにくさ</li>
<li>自宅サーバの老朽化  </li>
</ul>
<p>一番大きかった要因が2つめの <strong>記事の書きにくさ</strong> でした。<br>WebUI上で書くのですが、私のPCではブラウザをフル画面表示ではなく、1280*1024程度のサイズにして使用しています。そうするとUIがかなりきつきつで書きにくいのです。<br>UIもきつきつですが、私の場合Wordpressで記事を更新するときは、画像の挿入などで記事編集のテキストモードとビジュアルモードを入ったり来たりしていたため、あまり効率的ではありませんでした。</p>
<p>また、サーバの老朽化も進んでおり、購入から5年以上経過していました。webサイトをWpからhexoへ移行する際、サーバをVPS上へと移行しました。</p>
<h1 id="移行時に実現したかったこと"><a href="#移行時に実現したかったこと" class="headerlink" title="移行時に実現したかったこと"></a>移行時に実現したかったこと</h1><ul>
<li>記事をパソコン一つあれば外出先からでも更新出来る環境</li>
<li>なるべく記事更新がシンプルにできること</li>
<li>管理の手間を減らす</li>
<li>IPv6環境は引き続き対応</li>
</ul>
<h1 id="最終目標"><a href="#最終目標" class="headerlink" title="最終目標"></a>最終目標</h1><ol>
<li>Cloud9上から<code>hexo deploy</code>を実施しただけで、gitlab上へ公開データを転送。</li>
<li>gitlabがpushを検知し、VPS上へwebhookを投げる</li>
<li>VPS上のwebhookサーバがwebhookを受信し、webコンテナを再起動。再起動時に最新の公開データをgitlabからclone</li>
<li><p>最新のweb公開データを持ったコンテナが自動起動</p>
<p>つまり、ブログの更新ユーザはcloud9上で<code>hexo deploy</code>だけで、常にweb公開データを持ったコンテナが自動再起動される素敵環境を構築します。</p>
</li>
</ol>
<h1 id="結果"><a href="#結果" class="headerlink" title="結果"></a>結果</h1><ul>
<li>やりたいことは全て実現出来た</li>
</ul>
<h3 id="ついでに実現できちゃった事"><a href="#ついでに実現できちゃった事" class="headerlink" title="ついでに実現できちゃった事"></a>ついでに実現できちゃった事</h3><ul>
<li>HTTPSへの対応。しかもHSTS対応まで出来てしまった。万歳🙌</li>
<li>HTTP/2（SPDY4）への対応。⚡</li>
</ul>
<p>環境の構築については次の記事から記述していきます。</p>

                <!-- 2017.05.24 twitter and hatebu share button Add -->
        <div class="share-button">
          <!-- twitter share button -->
          <a href="https://twitter.com/share" class="twitter-share-button" data-url="https://www.tooth-pick.xyz/2017/03/25/easy-cms-system-1/" data-text="dockerとgitlabを使ったお手軽CMS環境構築　その1 | tooth-pick" data-lang="ja">ツイート</a>
          <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
        <!-- twitter share button End -->
        <!--  hatebu share button Start -->
          <a href="http://b.hatena.ne.jp/entry/https://www.tooth-pick.xyz/2017/03/25/easy-cms-system-1/" class="hatena-bookmark-button" data-hatena-bookmark-title="dockerとgitlabを使ったお手軽CMS環境構築　その1" data-hatena-bookmark-layout="standard-balloon" data-hatena-bookmark-lang="ja" title="このエントリーをはてなブックマークに追加"><img src="https://b.st-hatena.com/images/entry-button/button-only@2x.png" alt="このエントリーをはてなブックマークに追加" width="20" height="20" style="border: none;" /></a><script type="text/javascript" src="https://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script>
        <!-- hatebu share button End -->
        </div>
        <!-- twitter and hatebu share button End -->
      
    </div>
    <footer class="article-footer">
      <a data-url="https://www.tooth-pick.xyz/2017/03/25/easy-cms-system-1/" data-id="cj331l1at0013aaoiyq0ra9rd" class="article-share-link">Share</a>
      
        <a href="https://www.tooth-pick.xyz/2017/03/25/easy-cms-system-1/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Cloud9/">Cloud9</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/docker/">docker</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/gitlab/">gitlab</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/hexo/">hexo</a></li></ul>

      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2017/03/25/easy-cms-system-2/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          dockerとgitlabを使ったお手軽CMS環境構築　その2
        
      </div>
    </a>
  
  
    <a href="/2017/03/21/buy-chinese-earphone-magaosi-k3pro/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">中華イヤホンMAGAOSI K3 Proレビュー</div>
    </a>
  
</nav>

  
</article>


<section id="comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>
</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Mobile/">Mobile</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Mobile/Android/">Android</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Mobile/WindowsPhone/">WindowsPhone</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/カメラ/">カメラ</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/サーバ/">サーバ</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/ソフトウェア/">ソフトウェア</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/即売会/">即売会</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/家電/">家電</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/家電/オーディオ/">オーディオ</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/家電/オーディオ/中華イヤホン/">中華イヤホン</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/雑記/">雑記</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Cloud9/">Cloud9</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/K3/">K3</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/KZ-ED9/">KZ ED9</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MAGAOSI/">MAGAOSI</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cadvisor/">cadvisor</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/">docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gitlab/">gitlab</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/grafana/">grafana</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/">hexo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/prometheus/">prometheus</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/サーバ/">サーバ</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/中華イヤホン/">中華イヤホン</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Cloud9/" style="font-size: 16.67px;">Cloud9</a> <a href="/tags/K3/" style="font-size: 10px;">K3</a> <a href="/tags/KZ-ED9/" style="font-size: 10px;">KZ ED9</a> <a href="/tags/MAGAOSI/" style="font-size: 10px;">MAGAOSI</a> <a href="/tags/cadvisor/" style="font-size: 10px;">cadvisor</a> <a href="/tags/docker/" style="font-size: 20px;">docker</a> <a href="/tags/gitlab/" style="font-size: 16.67px;">gitlab</a> <a href="/tags/grafana/" style="font-size: 10px;">grafana</a> <a href="/tags/hexo/" style="font-size: 16.67px;">hexo</a> <a href="/tags/prometheus/" style="font-size: 10px;">prometheus</a> <a href="/tags/サーバ/" style="font-size: 10px;">サーバ</a> <a href="/tags/中華イヤホン/" style="font-size: 13.33px;">中華イヤホン</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">5月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">4月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">3月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">2月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">1月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">12月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">10月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">9月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">8月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">6月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">5月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/02/">2月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">12月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/11/">11月 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/06/">6月 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/04/">4月 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/12/">12月 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/08/">8月 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/06/">6月 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/03/">3月 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/06/">6月 2012</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/05/">5月 2012</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2017/05/14/prometheus-grafana-easy-install/">prometheusとgrafanaで良い感じにdockerコンテナとホストを監視する</a>
          </li>
        
          <li>
            <a href="/2017/04/15/easy-cms-system-4/">dockerとgitlabを使ったお手軽CMS環境構築　その4</a>
          </li>
        
          <li>
            <a href="/2017/04/02/easy-cms-system-3/">dockerとgitlabを使ったお手軽CMS環境構築　その3</a>
          </li>
        
          <li>
            <a href="/2017/03/25/easy-cms-system-2/">dockerとgitlabを使ったお手軽CMS環境構築　その2</a>
          </li>
        
          <li>
            <a href="/2017/03/25/easy-cms-system-1/">dockerとgitlabを使ったお手軽CMS環境構築　その1</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">links</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="//www.tooth-pick.xyz/" target="_blank">TOP Page</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    
<div class="widget-wrap">
<h3 class="widget-title">IPv6 Enable</h3>
<div class="widget">
<!-- start -->
<img src="/img/ipv6/ipv6_enable_logo.jpg" width="50%" height="50%" >
<!-- end -->
</div>
</div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 tumayouzi<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="//www.tooth-pick.xyz/doujin/" class="mobile-nav-link">同人</a>
  
    <a href="//www.tooth-pick.xyz/make_app/" class="mobile-nav-link">作った物</a>
  
    <a href="https://twitter.com/#!/tumayouzi_s" class="mobile-nav-link">Twitter</a>
  
    <a href="https://www.flickr.com/photos/tumayouzi/" class="mobile-nav-link">Flickr</a>
  
    <a href="https://tumayouzi.tumblr.com/" class="mobile-nav-link">Tumblr</a>
  
    <a href="//www.amazon.co.jp/registry/wishlist/11MRS9G3P6DDA/ref=cm_sw_r_tw_ws_YN7bxb0C1QVDC" class="mobile-nav-link">欲しいものリスト</a>
  
</nav>
    
<script>
  var disqus_shortname = 'tooth-pick';
  
  var disqus_url = 'https://www.tooth-pick.xyz/2017/03/25/easy-cms-system-1/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>